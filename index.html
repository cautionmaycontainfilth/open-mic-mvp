<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Open Mic</title>

	<style>
		body {
			margin: 0;
			min-height: 100vh;
			background: radial-gradient(circle at top, #1a1a1a, #0b0b0b);
			color: #f5f5f5;
			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
			display: flex;
			justify-content: center;
			align-items: center;
		}

		.container {
			text-align: center;
			max-width: 720px;
			width: 100%;
			padding: 40px;
		}

		h1 {
			font-size: 3rem;
			margin: 0 0 10px 0;
			letter-spacing: 0.2px;
		}

		p {
			opacity: 0.75;
			margin: 0 0 26px 0;
		}

		.rooms {
			display: flex;
			gap: 16px;
			justify-content: center;
			flex-wrap: wrap;
		}

		.room-link {
			text-decoration: none;
		}

		.room-button {
			background: rgba(255, 255, 255, 0.04);
			border: 1px solid rgba(255, 255, 255, 0.10);
			color: #f5f5f5;
			padding: 16px 26px;
			font-size: 1rem;
			cursor: pointer;
			transition: transform 0.18s ease, box-shadow 0.18s ease, background 0.18s ease, border-color 0.18s ease;
			border-radius: 10px;
			min-width: 180px;
			position: relative;
			overflow: hidden;
			text-align: left;
		}

		.room-button::before {
			content: "";
			position: absolute;
			inset: 0;
			background: radial-gradient(circle at top left, rgba(255, 255, 255, 0.18), transparent 55%);
			opacity: 0;
			transition: opacity 0.18s ease;
			pointer-events: none;
		}

		.room-button:hover::before {
			opacity: 1;
		}

		.room-button:hover {
			transform: translateY(-2px);
		}

		.room-title {
			display: block;
			font-weight: 600;
			letter-spacing: 0.2px;
		}

		.room-sub {
			display: block;
			margin-top: 6px;
			font-size: 0.82rem;
			opacity: 0.65;
			font-weight: 400;
		}

		/* Room-specific glow */
		.room-button.pub:hover {
			background: rgba(245, 193, 108, 0.10);
			border-color: rgba(245, 193, 108, 0.35);
			box-shadow: 0 14px 40px rgba(245, 193, 108, 0.15);
		}

		.room-button.club:hover {
			background: rgba(255, 42, 109, 0.10);
			border-color: rgba(255, 42, 109, 0.35);
			box-shadow: 0 14px 40px rgba(255, 42, 109, 0.18);
		}

		.room-button.basement:hover {
			background: rgba(42, 157, 143, 0.10);
			border-color: rgba(42, 157, 143, 0.35);
			box-shadow: 0 14px 40px rgba(42, 157, 143, 0.18);
		}

		/* Tiny hint */
		.audio-hint {
			margin-top: 18px;
			opacity: 0.55;
			font-size: 0.9rem;
		}
	</style>
</head>

<body>
	<div class="container">
		<h1>Open Mic</h1>
		<h1>Powered by The Merit Engine™</h1>
		<p>Discover your next favourite artist...</p>

		<div class="rooms">
			<a class="room-link" href="pub.html">
				<button class="room-button pub" data-room="pub">
					<span class="room-title">The Pub</span>
					<span class="room-sub">indie / alt / folk</span>
				</button>
			</a>

			<a class="room-link" href="club.html">
				<button class="room-button club" data-room="club">
					<span class="room-title">The Club</span>
					<span class="room-sub">rap / trap / drill</span>
				</button>
			</a>

			<a class="room-link" href="basement.html">
				<button class="room-button basement" data-room="basement">
					<span class="room-title">The Basement</span>
					<span class="room-sub">dnb / jungle / experimental</span>
				</button>
			</a>
		</div>

		<div class="audio-hint">
			Hover over a room to hear who's playing tonight.
		</div>
	</div>

	<script>
		// ---------- OUTSIDE-THE-DOOR PREVIEW SYSTEM ----------
		// Put these files in: /audio/pub.mp3 /audio/club.mp3 /audio/basement.mp3
		const PREVIEW_FILES = {
			pub: "audio/pub.mp3",
			club: "audio/club.mp3",
			basement: "audio/basement.mp3"
		};

		const PREVIEW_SECONDS = 10;

		// Web Audio setup for muffled effect
		const AudioContext = window.AudioContext || window.webkitAudioContext;
		const ctx = new AudioContext();

		const audioEl = new Audio();
		audioEl.preload = "auto";
		audioEl.crossOrigin = "anonymous";

		const source = ctx.createMediaElementSource(audioEl);

		// Low-pass filter to simulate "outside the room"
		const lowpass = ctx.createBiquadFilter();
		lowpass.type = "lowpass";
		lowpass.frequency.value = 10000; // lower = more muffled
		lowpass.Q.value = 0.8;

		// Tiny gain to keep it subtle (like distance)
		const gain = ctx.createGain();
		gain.gain.value = 0.55;

		source.connect(lowpass);
		lowpass.connect(gain);
		gain.connect(ctx.destination);

		let stopTimer = null;
		let currentRoom = null;

		function stopPreview() {
			if (stopTimer) clearTimeout(stopTimer);
			stopTimer = null;
			currentRoom = null;
			audioEl.pause();
			audioEl.currentTime = 0;
		}

		async function playPreview(room) {
			// Avoid restarting the same one repeatedly
			if (currentRoom === room && !audioEl.paused) return;

			// iOS/Safari often needs a user gesture to start audio context
			if (ctx.state === "suspended") {
				try { await ctx.resume(); } catch (e) { }
			}

			currentRoom = room;
			audioEl.src = PREVIEW_FILES[room];
			audioEl.currentTime = 0;

			try {
				await audioEl.play();
			} catch (e) {
				// Autoplay blocked — user needs a tap first. That's normal on mobile.
				return;
			}

			if (stopTimer) clearTimeout(stopTimer);
			stopTimer = setTimeout(stopPreview, PREVIEW_SECONDS * 1000);
		}

		// Desktop hover behavior
		document.querySelectorAll(".room-button").forEach(btn => {
			const room = btn.dataset.room;

			btn.addEventListener("mouseenter", () => playPreview(room));
			btn.addEventListener("mouseleave", stopPreview);

			// Mobile fallback: tap plays preview (second tap can click link)
			btn.addEventListener("touchstart", (e) => {
				// first touch triggers preview without navigating immediately
				if (ctx.state === "suspended" || audioEl.paused) {
					e.preventDefault();
					playPreview(room);
				}
			}, { passive: false });
		});

		// Safety: stop audio when switching tabs
		document.addEventListener("visibilitychange", () => {
			if (document.hidden) stopPreview();
		});
	</script>
</body>

</html>